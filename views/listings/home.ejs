<% layout("/layouts/boilerplate") %>

<!-- Flash Messages Container -->
<div id="flashContainer">
  <% if (success && success.length > 0) { %>
    <div class="alert alert-success alert-dismissible fade show shadow-sm border-0 mx-3 mt-3" role="alert">
      <div class="d-flex align-items-center">
        <i class="bi bi-check-circle-fill me-2 fs-5"></i>
        <strong>Success!</strong> <%= success %>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>

  <% if (error && error.length > 0) { %>
    <div class="alert alert-danger alert-dismissible fade show shadow-sm border-0 mx-3 mt-3" role="alert">
      <div class="d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
        <strong>Error!</strong> <%= error %>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>
</div>

<!-- Link to external CSS -->
<link rel="stylesheet" href="/css/style.css">

<!-- Hero Section -->
<div id="hero-section" class="position-relative vh-100 w-100 d-flex flex-column justify-content-center align-items-center text-center text-white px-3" 
     style="transition: background-image 1.5s ease-in-out; background-size: cover; background-position: center;">
  
  <!-- Floating particles -->
  <div id="particles-container"></div>
  
  <!-- Overlay for better text readability -->
  <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-50"></div>
  
  <!-- Hero Content -->
  <div class="position-relative z-3">
    <h1 class="display-2 fw-bold mb-3 animate__animated animate__fadeInUp" id="hero-title">
      Welcome to <span class="text-warning typewriter">WonderLust</span> üåç
    </h1>
    <p class="lead fs-4 mb-4 animate__animated animate__fadeInUp animate__delay-1s" id="hero-subtitle">
      Discover amazing stays around the world and create unforgettable memories
    </p>
    <div class="d-flex gap-3 justify-content-center flex-wrap animate__animated animate__fadeInUp animate__delay-2s">
      <a href="/listings" class="btn btn-danger btn-lg px-5 shadow-lg pulse-btn">
        <i class="bi bi-compass"></i> Explore Listings
      </a>
      <a href="/listings/new" class="btn btn-outline-light btn-lg px-5 shadow-lg glow-btn">
        <i class="bi bi-plus-circle"></i> Add Your Property
      </a>
    </div>
    
    <!-- Live search preview -->
    <div class="mt-5 animate__animated animate__fadeInUp animate__delay-3s">
      <div class="search-preview-container">
        <div class="input-group input-group-lg shadow-lg">
          <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" placeholder="Where do you want to go?" id="liveSearch">
          <button class="btn btn-warning" type="button" onclick="searchDestination()">Search</button>
        </div>
        <div id="searchSuggestions" class="search-suggestions"></div>
      </div>
    </div>
  </div>
  
  <!-- Live weather widget -->
  <div class="position-absolute top-0 end-0 m-4">
    <div class="weather-widget bg-dark bg-opacity-75 text-white p-3 rounded">
      <div class="d-flex align-items-center">
        <i class="bi bi-sun weather-icon me-2"></i>
        <div>
          <div class="fw-bold" id="currentTemp">--¬∞C</div>
          <small id="currentLocation">Loading...</small>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Scroll indicator with animation -->
  <div class="position-absolute bottom-0 start-50 translate-middle-x mb-4">
    <div class="scroll-indicator floating">
      <i class="bi bi-chevron-down text-white fs-3"></i>
    </div>
  </div>
</div>

<!-- Live Statistics Banner -->
<div class="live-stats-banner bg-gradient text-white py-2" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-3 col-6">
        <span class="fw-bold">üî• <span id="activeUsers">247</span> active users</span>
      </div>
      <div class="col-md-3 col-6">
        <span class="fw-bold">üìç <span id="newListings">12</span> new listings today</span>
      </div>
      <div class="col-md-3 col-6">
        <span class="fw-bold">‚≠ê <span id="reviewsToday">89</span> reviews today</span>
      </div>
      <div class="col-md-3 col-6">
        <span class="fw-bold">üéâ <span id="bookingsToday">156</span> bookings today</span>
      </div>
    </div>
  </div>
</div>

<!-- Features Section -->
<section class="py-5 bg-light">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-12">
        <h2 class="display-5 fw-bold mb-3">Why Choose WonderLust?</h2>
        <p class="lead text-muted">Experience travel like never before with our premium features</p>
      </div>
    </div>
    
    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm text-center hover-lift">
          <div class="card-body p-4">
            <div class="bg-primary bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                 style="width: 70px; height: 70px;">
              <i class="bi bi-shield-check text-white fs-2"></i>
            </div>
            <h4 class="fw-bold mb-3">Verified Properties</h4>
            <p class="text-muted">All properties are verified and quality-checked for your safety and comfort.</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm text-center hover-lift">
          <div class="card-body p-4">
            <div class="bg-success bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                 style="width: 70px; height: 70px;">
              <i class="bi bi-headset text-white fs-2"></i>
            </div>
            <h4 class="fw-bold mb-3">24/7 Support</h4>
            <p class="text-muted">Round-the-clock customer support to help you with any queries or issues.</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm text-center hover-lift">
          <div class="card-body p-4">
            <div class="bg-warning bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                 style="width: 70px; height: 70px;">
              <i class="bi bi-lightning-charge text-white fs-2"></i>
            </div>
            <h4 class="fw-bold mb-3">Instant Booking</h4>
            <p class="text-muted">Book instantly without waiting for host approval. Quick and hassle-free.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Statistics Section -->
<section class="py-5 bg-primary text-white">
  <div class="container">
    <div class="row text-center">
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="counter-item">
          <h2 class="display-4 fw-bold mb-2" data-count="1000">0</h2>
          <p class="lead mb-0">Happy Travelers</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="counter-item">
          <h2 class="display-4 fw-bold mb-2" data-count="500">0</h2>
          <p class="lead mb-0">Properties Listed</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="counter-item">
          <h2 class="display-4 fw-bold mb-2" data-count="50">0</h2>
          <p class="lead mb-0">Countries</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="counter-item">
          <h2 class="display-4 fw-bold mb-2" data-count="98">0</h2>
          <p class="lead mb-0">% Satisfaction</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- How It Works Section -->
<section class="py-5">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-12">
        <h2 class="display-5 fw-bold mb-3">How It Works</h2>
        <p class="lead text-muted">Simple steps to find your perfect stay</p>
      </div>
    </div>
    
    <div class="row g-4">
      <div class="col-lg-4 text-center">
        <div class="step-item">
          <div class="step-number bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
               style="width: 60px; height: 60px;">
            <span class="fs-3 fw-bold">1</span>
          </div>
          <h4 class="fw-bold mb-3">Search & Discover</h4>
          <p class="text-muted">Browse through thousands of verified properties worldwide using our smart filters.</p>
        </div>
      </div>
      
      <div class="col-lg-4 text-center">
        <div class="step-item">
          <div class="step-number bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
               style="width: 60px; height: 60px;">
            <span class="fs-3 fw-bold">2</span>
          </div>
          <h4 class="fw-bold mb-3">Book Instantly</h4>
          <p class="text-muted">Select your dates, review details, and book your perfect stay with just a few clicks.</p>
        </div>
      </div>
      
      <div class="col-lg-4 text-center">
        <div class="step-item">
          <div class="step-number bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
               style="width: 60px; height: 60px;">
            <span class="fs-3 fw-bold">3</span>
          </div>
          <h4 class="fw-bold mb-3">Enjoy Your Stay</h4>
          <p class="text-muted">Check-in seamlessly and enjoy your vacation. Leave a review to help future travelers.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
  <div class="container text-center text-white">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <h2 class="display-5 fw-bold mb-4">Ready to Start Your Journey?</h2>
        <p class="lead mb-4">Join thousands of travelers who have found their perfect stays with WonderLust</p>
        <div class="d-flex gap-3 justify-content-center flex-wrap">
          <a href="/listings" class="btn btn-light btn-lg px-5">
            <i class="bi bi-search"></i> Find Your Stay
          </a>
          <a href="/listings/new" class="btn btn-outline-light btn-lg px-5">
            <i class="bi bi-house-add"></i> List Your Property
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Live Interactive Map Section -->
<section class="py-5 bg-dark text-white">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-12">
        <h2 class="display-5 fw-bold mb-3">üåç Explore Popular Destinations</h2>
        <p class="lead text-light">Click on the hotspots to discover amazing places around the world</p>
        <div class="d-flex justify-content-center gap-3 flex-wrap mt-3">
          <span class="badge bg-danger fs-6"><i class="bi bi-geo-alt-fill"></i> 4 Featured Cities</span>
          <span class="badge bg-warning text-dark fs-6"><i class="bi bi-house-fill"></i> 835+ Listings</span>
          <span class="badge bg-info fs-6"><i class="bi bi-star-fill"></i> Top Rated</span>
        </div>
      </div>
    </div>
    
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="interactive-map-container">
          <div class="world-map position-relative p-4 bg-gradient rounded-4" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 400px;">
            <!-- World Map SVG Background -->
            <div class="map-background position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
              <svg width="100%" height="100%" viewBox="0 0 800 400" style="max-width: 700px; opacity: 0.3;">
                <!-- Simplified world map paths -->
                <path d="M100 200 Q200 150 300 180 Q400 200 500 170 Q600 160 700 180" stroke="#ffffff" stroke-width="2" fill="none"/>
                <path d="M120 250 Q250 220 350 240 Q450 260 550 230 Q650 220 720 240" stroke="#ffffff" stroke-width="2" fill="none"/>
                <circle cx="150" cy="180" r="3" fill="#ffffff"/>
                <circle cx="300" cy="200" r="3" fill="#ffffff"/>
                <circle cx="500" cy="190" r="3" fill="#ffffff"/>
                <circle cx="650" cy="170" r="3" fill="#ffffff"/>
              </svg>
            </div>
            
            <!-- Interactive hotspots with improved positioning -->
            <div class="hotspot hotspot-1" data-city="Paris" data-listings="145" data-country="France" style="position: absolute; top: 35%; left: 52%;">
              <div class="pulse-dot"></div>
              <div class="hotspot-info">
                <strong>üá´üá∑ Paris</strong><br>
                <small>145 listings ‚Ä¢ Europe</small>
              </div>
            </div>
            
            <div class="hotspot hotspot-2" data-city="Tokyo" data-listings="289" data-country="Japan" style="position: absolute; top: 40%; left: 80%;">
              <div class="pulse-dot"></div>
              <div class="hotspot-info">
                <strong>üáØüáµ Tokyo</strong><br>
                <small>289 listings ‚Ä¢ Asia</small>
              </div>
            </div>
            
            <div class="hotspot hotspot-3" data-city="New York" data-listings="234" data-country="USA" style="position: absolute; top: 38%; left: 25%;">
              <div class="pulse-dot"></div>
              <div class="hotspot-info">
                <strong>üá∫üá∏ New York</strong><br>
                <small>234 listings ‚Ä¢ Americas</small>
              </div>
            </div>
            
            <div class="hotspot hotspot-4" data-city="Mumbai" data-listings="167" data-country="India" style="position: absolute; top: 50%; left: 70%;">
              <div class="pulse-dot"></div>
              <div class="hotspot-info">
                <strong>üáÆüá≥ Mumbai</strong><br>
                <small>167 listings ‚Ä¢ Asia</small>
              </div>
            </div>

            <!-- Additional Visual Elements -->
            <div class="position-absolute bottom-0 start-0 p-3">
              <small class="text-light opacity-75">
                <i class="bi bi-info-circle me-1"></i>
                Click any hotspot to explore destinations
              </small>
            </div>
            
            <div class="position-absolute top-0 end-0 p-3">
              <div class="d-flex gap-2">
                <span class="legend-item">
                  <span class="pulse-dot-mini bg-danger"></span>
                  <small class="text-light ms-1">Hot Destinations</small>
                </span>
              </div>
            </div>
          </div>
          
          <!-- Quick Access Cards -->
          <div class="row mt-4 g-3">
            <div class="col-md-3 col-6">
              <div class="destination-card bg-white text-dark rounded-3 p-3 text-center h-100 hover-lift cursor-pointer" onclick="searchByCity('Paris')">
                <div class="fs-1 mb-2">üá´üá∑</div>
                <h6 class="fw-bold mb-1">Paris</h6>
                <small class="text-muted">145 properties</small>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="destination-card bg-white text-dark rounded-3 p-3 text-center h-100 hover-lift cursor-pointer" onclick="searchByCity('Tokyo')">
                <div class="fs-1 mb-2">üáØüáµ</div>
                <h6 class="fw-bold mb-1">Tokyo</h6>
                <small class="text-muted">289 properties</small>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="destination-card bg-white text-dark rounded-3 p-3 text-center h-100 hover-lift cursor-pointer" onclick="searchByCity('New York')">
                <div class="fs-1 mb-2">üá∫üá∏</div>
                <h6 class="fw-bold mb-1">New York</h6>
                <small class="text-muted">234 properties</small>
              </div>
            </div>
            <div class="col-md-3 col-6">
              <div class="destination-card bg-white text-dark rounded-3 p-3 text-center h-100 hover-lift cursor-pointer" onclick="searchByCity('Mumbai')">
                <div class="fs-1 mb-2">üáÆüá≥</div>
                <h6 class="fw-bold mb-1">Mumbai</h6>
                <small class="text-muted">167 properties</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Live Testimonials Carousel -->
<section class="py-5 bg-light">
  <div class="container">
    <div class="row text-center mb-5">
      <div class="col-12">
        <h2 class="display-5 fw-bold mb-3">What Our Travelers Say</h2>
        <p class="lead text-muted">Real reviews from real travelers</p>
      </div>
    </div>
    
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <div class="testimonial-card text-center p-4">
                <div class="stars mb-3">
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                </div>
                <blockquote class="blockquote">
                  <p class="mb-4 fs-5">"Amazing platform! Found the perfect beach house in Goa. The booking process was seamless."</p>
                </blockquote>
                <div class="testimonial-author">
                  <img src="https://randomuser.me/api/portraits/women/1.jpg" alt="Sarah" class="rounded-circle mb-2" width="60">
                  <h6 class="mb-0">Sarah Johnson</h6>
                  <small class="text-muted">Verified Traveler</small>
                </div>
              </div>
            </div>
            
            <div class="carousel-item">
              <div class="testimonial-card text-center p-4">
                <div class="stars mb-3">
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                </div>
                <blockquote class="blockquote">
                  <p class="mb-4 fs-5">"Listed my property and got bookings within 24 hours. Great support team!"</p>
                </blockquote>
                <div class="testimonial-author">
                  <img src="https://randomuser.me/api/portraits/men/2.jpg" alt="Raj" class="rounded-circle mb-2" width="60">
                  <h6 class="mb-0">Raj Patel</h6>
                  <small class="text-muted">Property Owner</small>
                </div>
              </div>
            </div>
            
            <div class="carousel-item">
              <div class="testimonial-card text-center p-4">
                <div class="stars mb-3">
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star-fill text-warning"></i>
                  <i class="bi bi-star text-warning"></i>
                </div>
                <blockquote class="blockquote">
                  <p class="mb-4 fs-5">"Love the variety of options. From budget hostels to luxury villas, found it all here!"</p>
                </blockquote>
                <div class="testimonial-author">
                  <img src="https://randomuser.me/api/portraits/women/3.jpg" alt="Emily" class="rounded-circle mb-2" width="60">
                  <h6 class="mb-0">Emily Chen</h6>
                  <small class="text-muted">Frequent Traveler</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Link to external JavaScript -->
<script src="/js/main.js"></script>

<script>
// Fixed search functionality
function searchDestination() {
  const query = document.getElementById('liveSearch').value.trim();
  if (query) {
    // Redirect to listings with search parameter
    window.location.href = `/listings?search=${encodeURIComponent(query)}`;
  } else {
    // Show error message if search is empty
    if (typeof showFlashMessage === 'function') {
      showFlashMessage('warning', 'Search Required', 'Please enter a destination to search.');
    } else {
      alert('Please enter a destination to search.');
    }
  }
}

// Search by city function for destination cards
function searchByCity(city) {
  if (typeof showFlashMessage === 'function') {
    showFlashMessage('info', 'Searching', `Finding amazing places in ${city}...`);
  }
  
  setTimeout(() => {
    window.location.href = `/listings?search=${encodeURIComponent(city)}`;
  }, 800);
}

// Enhanced enter key support for search
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('liveSearch');
  if (searchInput) {
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        searchDestination();
      }
    });
  }

  // Auto-dismiss flash messages with error handling
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(alert => {
    setTimeout(() => {
      try {
        if (typeof bootstrap !== 'undefined' && bootstrap.Alert) {
          const alertInstance = new bootstrap.Alert(alert);
          alertInstance.close();
        } else {
          // Fallback if Bootstrap is not loaded
          alert.style.display = 'none';
        }
      } catch (error) {
        console.log('Error dismissing alert:', error);
        alert.style.display = 'none';
      }
    }, 5000);
  });

  // Initialize main.js functions with error handling
  if (typeof window.homePageInit === 'function') {
    try {
      window.homePageInit();
    } catch (error) {
      console.error('Error initializing home page:', error);
    }
  }

  // Check if main.js loaded properly
  if (typeof showFlashMessage !== 'function') {
    console.warn('main.js may not have loaded properly - some functionality may be limited');
  }

  // Add enhanced destination card interactions
  const destinationCards = document.querySelectorAll('.destination-card');
  destinationCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-8px) scale(1.02)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0) scale(1)';
    });
  });
});

// Make searchByCity globally available
window.searchByCity = searchByCity;
</script>

<style>
/* Flash message styling */
.alert {
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border-left: 4px solid;
  animation: slideInDown 0.5s ease-out;
  position: relative;
  z-index: 1000;
}

.alert-success {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  border-left-color: #28a745;
  color: #155724;
}

.alert-danger {
  background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
  border-left-color: #dc3545;
  color: #721c24;
}

@keyframes slideInDown {
  from {
    transform: translateY(-100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.alert-dismissible .btn-close {
  position: absolute;
  top: 50%;
  right: 1rem;
  transform: translateY(-50%);
  padding: 0.5rem;
  background: rgba(0,0,0,0.1);
  border-radius: 50%;
  opacity: 0.7;
  transition: all 0.2s ease;
}

.alert-dismissible .btn-close:hover {
  opacity: 1;
  background: rgba(0,0,0,0.2);
  transform: translateY(-50%) scale(1.1);
}
</style>
